/* 
** Copyright 1998-2008, Pete J. Jensen
** Copyright 1998-2008, Robin McNeil
** All Rights Reserved.
** 
** This is UNPUBLISHED PROPRIETARY SOURCE CODE of the authors
** the contents of this file may not be disclosed to third parties, copied or
** duplicated in any form, in whole or in part, without the prior written
** permission of the authors.
** 
** RESTRICTED RIGHTS LEGEND:
** Use, duplication or disclosure by the Government is subject to restrictions
** as set forth in subdivision (c)(1)(ii) of the Rights in Technical Data
** and Computer Software clause at DFARS 252.227-7013, and/or in similar or
** successor clauses in the FAR, DOD or NASA FAR Supplement. Unpublished -
** rights reserved under the Copyright Laws of the United States.
**
**        ______
**       /_____/\
**      /_____\\ \      FILE:    sounds.h
**     /_____\ \\ /     AUTHOR:  Pete Jensen
**    /_____/ \/ / /    AUTHOR:  Robin McNeil
**   /_____/ /   \//\   VERSION: 1.0.0
**   \_____\//\   / /   
**    \_____/ / /\ /    
**     \_____/ \\ \     
**      \_____\ \\ 
**       \_____\/
**/
#include <stdio.h>
#include <conio.h>
#include <stdlib.h>
#include <math.h>

#include "tile.h"
#include "graph.h"
#include "globals.h"

struct {
	double percentStars;
	double percentBombs;
} tileLevel[TILE_LEVELS];

// Tile level.
int cLevel = 2;

void tile_initializeTileLevels(){
	
	// Initialize the first tile level; where both stars and bombs 
	// do not occur.
	tileLevel[0].percentStars = 0.0;
	tileLevel[0].percentBombs = 0.0;
	
	// Initialize the second (1st index) tile level
	tileLevel[1].percentStars = 10.0;
	tileLevel[1].percentBombs = 0.0;
	
	
	// Initializes tile level 2.
	tileLevel[2].percentStars = 15.0;
	tileLevel[2].percentBombs = 0.05;
	
	// Init tile level 3.
	tileLevel[3].percentStars = 20.0;
	tileLevel[3].percentBombs = 0.02;
}

void tile_generateRandom(TILE* tile, int maxColor){
	/* Select a random tile to put here */
	tile->type = (int)((float)(maxColor + 1) * rand()/(float)(RAND_MAX));

	/* Set star based on the percent of stars to be created. */
	if ((int)((float)100 * rand()/(float)(RAND_MAX)) < 
			tileLevel[cLevel].percentStars)
				tile->star = 1;
}

void tile_render(int x, int y, TILE *tile) {
	
	register int xIndex;
	register int yIndex;
	TILE_TEXTURE_PTR tex = 0;
	
	for (xIndex = 0; xIndex < TILE_WIDTH; xIndex++){
		for (yIndex = 0; yIndex < TILE_HEIGHT; yIndex++){
			
			tex = 0;
			
			switch (tile->type) {
				
				case TILE_RED:
					tex = &TILE_RED_TEXTURE;
					break;
					
				case TILE_BLUE:
					tex = &TILE_BLUE_TEXTURE;
					break;
					
				case TILE_YELLOW:
					tex = &TILE_YELLOW_TEXTURE;
					break;
					
				case TILE_GREEN:
					tex = &TILE_GREEN_TEXTURE;
					break;
						
				case TILE_INDIGO:
					tex = &TILE_INDIGO_TEXTURE;
					break;
						
				case TILE_SUPERSTAR:
					tex = &TILE_SUPERSTAR_TEXTURE;
					break;
						
				default:
					tex = 0;
					break;
			}
			
			if( tex == 0 )
				putPixel(xIndex + x, yIndex + y, 0);
			else	
				putPixel(xIndex + x, yIndex + y, 
					(*tex)[xIndex][yIndex]);
				
			if (tile->star && tile->type != TILE_EMPTY)	
				if (TILE_STAR_TEXTURE[xIndex][yIndex] != 0x00)
					putPixel(xIndex + x, yIndex + y, 
						TILE_STAR_TEXTURE[xIndex][yIndex]);
		}
	}
	
	return;
}

void tile_swap(TILE *a, TILE *b){
	
	TILE temp;
	
	temp.type = a->type;
	temp.star = a->star;
	
	a->type = b->type;
	a->star = b->star;
	
	b->type = temp.type;
	b->star = temp.star;
	
	return;
}

int TILE_GREEN_TEXTURE[TILE_WIDTH][TILE_HEIGHT] = 
{ 
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  },
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249},
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249},
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249},
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249},
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249}, 
	{0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 249},
	{0, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249}
};

int TILE_RED_TEXTURE[TILE_WIDTH][TILE_HEIGHT] = 
{ 
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  },
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249},
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249},
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249},
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249},
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249}, 
	{0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 249},
	{0, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249}
};

int TILE_BLUE_TEXTURE[TILE_WIDTH][TILE_HEIGHT] = 
{ 
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  },
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249},
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249},
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249},
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249},
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249}, 
	{0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 249},
	{0, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249}
};

int TILE_YELLOW_TEXTURE[TILE_WIDTH][TILE_HEIGHT] = 
{ 
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  },
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249},
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249},
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249},
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249},
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249}, 
	{0, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 249},
	{0, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249}
};

int TILE_INDIGO_TEXTURE[TILE_WIDTH][TILE_HEIGHT] = 
{ 
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  },
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249},
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249},
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249},
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249},
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249}, 
	{0, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 249},
	{0, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249, 249}
};

int TILE_STAR_TEXTURE[TILE_WIDTH][TILE_HEIGHT] = 
{
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{30, 25, 0, 0, 0, 0, 29, 0, 0, 0, 0, 0, 30, 0, 0},
	{0, 27, 25, 0, 0, 0, 29, 0, 0, 0, 0, 27, 25, 0, 0},
	{0, 0, 27, 25, 0, 0, 28, 0, 0, 0, 27, 25, 0, 0, 0},
	{0, 0, 0, 27, 25, 0, 28, 0, 0, 27, 25, 0, 0, 0, 0},
	{0, 0, 0, 0, 27, 25, 27, 25, 27, 25, 0, 0, 0, 0, 0},
	{0, 0, 0, 0, 25, 28, 28, 28, 25, 0, 0, 0, 0, 0, 0},
	{30, 29, 28, 28, 27, 29, 29, 29, 27, 28, 28, 29, 30, 0, 0},
	{0, 0, 0, 0, 25, 28, 28, 28, 25, 0, 0, 0, 0, 0, 0},
	{0, 0, 0, 0, 27, 25, 27, 25, 27, 25, 0, 0, 0, 0, 0},
	{0, 0, 0, 27, 25, 0, 28, 0, 0, 27, 25, 0, 0, 0, 0},
	{0, 0, 27, 25, 0, 0, 28, 0, 0, 0, 27, 25, 0, 0, 0},
	{0, 27, 25, 0, 0, 0, 29, 0, 0, 0, 0, 27, 25, 0, 0},
	{30, 25, 0, 0, 0, 0, 29, 0, 0, 0, 0, 0, 30, 25, 0}
};

int TILE_SUPERSTAR_TEXTURE[TILE_WIDTH][TILE_HEIGHT] = 
{
	{16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16},
	{17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 16},
	{17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 17, 16},
	{17, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 18, 17, 16},
	{17, 18, 19, 20, 20, 20, 20, 20, 20, 20, 20, 19, 18, 17, 16},
	{17, 18, 19, 20, 21, 21, 21, 21, 21, 21, 20, 19, 18, 17, 16},
	{17, 18, 19, 20, 21, 22, 22, 22, 22, 21, 20, 19, 18, 17, 16},
	{17, 18, 19, 20, 21, 22, 23, 23, 22, 21, 20, 19, 18, 17, 16},
	{17, 18, 19, 20, 21, 22, 24, 24, 22, 21, 20, 19, 18, 17, 16},
	{17, 18, 19, 20, 21, 22, 22, 22, 22, 21, 20, 19, 18, 17, 16},
	{17, 18, 19, 20, 21, 21, 21, 21, 21, 21, 20, 19, 18, 17, 16},
	{17, 18, 19, 20, 20, 20, 20, 20, 20, 20, 20, 19, 18, 17, 16},
	{17, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 18, 17, 16},
	{17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 17, 16},
	{17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 16},
	{16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16}
};
 